blueprint:
  name: "ĞĞ±Ğ¾Ğ³Ñ€ĞµĞ²Ğ°Ñ‚ĞµĞ»ÑŒ + Ğ¡Ğ²ĞµÑ‚ (v2)"
  description: "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ· Ğ·Ğ°Ñ†Ğ¸ĞºĞ»Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ"
  domain: automation
  author: "Helper"
  input:
    heater_entity:
      name: "ğŸ”¥ ĞĞ±Ğ¾Ğ³Ñ€ĞµĞ²Ğ°Ñ‚ĞµĞ»ÑŒ (ĞšĞ¾Ğ²Ñ€Ğ¸Ğº)"
      selector:
        entity:
          domain: [switch, plug]
    light_entity:
      name: "ğŸ’¡ Ğ¡Ğ²ĞµÑ‚ (Ğ›Ğ¾Ğ´Ğ¶Ğ¸Ñ)"
      selector:
        entity:
          domain: [light]
    direction:
      name: "ğŸ”„ ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ"
      description: "ĞšĞ°ĞºĞ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ½ÑƒĞ¶Ğ½Ğ°"
      selector:
        select:
          options:
            - label: "ĞĞ±Ğ¾Ğ³Ñ€ĞµĞ²Ğ°Ñ‚ĞµĞ»ÑŒ â†’ Ğ¡Ğ²ĞµÑ‚"
              value: "heater_to_light"
            - label: "Ğ¡Ğ²ĞµÑ‚ â†’ ĞĞ±Ğ¾Ğ³Ñ€ĞµĞ²Ğ°Ñ‚ĞµĞ»ÑŒ"
              value: "light_to_heater"

trigger:
  - platform: state
    entity_id: !input heater_entity
    to: "on"
  - platform: state
    entity_id: !input heater_entity
    to: "off"
  - platform: state
    entity_id: !input light_entity
    to: "off"

condition:
  # ğŸ”¹ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ñ†Ğ¸ĞºĞ»Ğ°: Ğ½Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ, ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ² Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸
  - condition: template
    value_template: >-
      {% set heater = input('heater_entity') %}
      {% set light = input('light_entity') %}
      {% set direction = input('direction') %}
      {% if direction == 'heater_to_light' %}
        {{ states(light) != states(heater) }}
      {% else %}
        {{ trigger.entity_id == light and states(heater) != 'off' }}
      {% endif %}

action:
  - choose:
      - conditions:
          - condition: template
            value_template: >-
              {{ input('direction') == 'heater_to_light' }}
        sequence:
          - service: >-
              {{ 'homeassistant.turn_on' if trigger.to_state.state == 'on' else 'homeassistant.turn_off' }}
            target:
              entity_id: !input light_entity
    default:
      - service: homeassistant.turn_off
        target:
          entity_id: !input heater_entity

#mode: single
mode: restart
